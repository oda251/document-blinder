var content=function(){"use strict";var R=Object.defineProperty;var L=(h,l,c)=>l in h?R(h,l,{enumerable:!0,configurable:!0,writable:!0,value:c}):h[l]=c;var a=(h,l,c)=>L(h,typeof l!="symbol"?l+"":l,c);var A,z;function h(t){return t}const l="DBlinder";class c{constructor(e){a(this,"namespace");a(this,"GET");a(this,"SET");a(this,"CALL");this.namespace=`${l}:${e}`,this.GET=this.format("GET"),this.SET=this.format("SET"),this.CALL=this.format("CALL")}format(e){return`${this.namespace}:${e}`}}class r{}a(r,"isActivated",new c("is-activated")),a(r,"isHorizontal",new c("is-horizontal")),a(r,"spaceSize",new c("space-size")),a(r,"maxSpaceSize",new c("max-space-size")),a(r,"opacity",new c("opacity")),a(r,"config",new c("config")),a(r,"updateBlinds",new c("update-blinds"));const M={getIsActivated:async()=>chrome.runtime.sendMessage({type:r.isActivated.GET}),getIsHorizontal:async()=>chrome.runtime.sendMessage({type:r.isHorizontal.GET}),getSpaceSize:async()=>chrome.runtime.sendMessage({type:r.spaceSize.GET}),getMaxSpaceSize:async()=>chrome.runtime.sendMessage({type:r.maxSpaceSize.GET}),getOpacity:async()=>chrome.runtime.sendMessage({type:r.opacity.GET}),getConfig:async()=>chrome.runtime.sendMessage({type:r.config.GET}),setConfig:async t=>chrome.runtime.sendMessage({type:r.config.SET,value:t}),setIsActivated:async t=>chrome.runtime.sendMessage({type:r.isActivated.SET,value:t}),setIsHorizontal:async t=>chrome.runtime.sendMessage({type:r.isHorizontal.SET,value:t}),setSpaceSize:async t=>chrome.runtime.sendMessage({type:r.spaceSize.SET,value:t}),setMaxSpaceSize:async t=>chrome.runtime.sendMessage({type:r.maxSpaceSize.SET,value:t}),setOpacity:async t=>chrome.runtime.sendMessage({type:r.opacity.SET,value:t}),updateBlinds:async()=>{chrome.tabs.query({active:!0,currentWindow:!0},t=>{t.length!==0&&chrome.tabs.sendMessage(t[0].id,{type:r.updateBlinds.CALL})})}};async function T(t){const e=await M.getConfig();let n=Array.from(document.querySelectorAll(".document-blind"));if(e.isActivated){for(;n.length<2;){const i=document.createElement("div");i.classList.add("document-blind"),document.body.append(i),n.push(i)}const s=parseFloat(getComputedStyle(document.documentElement).fontSize),o=e.spaceSize*s/2,d=e.opacity;e.isHorizontal?n.forEach((i,u)=>{i.style.left="0px",i.style.width=`${window.innerWidth}px`,i.style.opacity=`${d}`,t instanceof MouseEvent?(i.style.top=`${u===0?0:t.clientY+o}px`,i.style.height=`${u===0?t.clientY-o:window.innerHeight-t.clientY-o}px`):(i.style.top=`${u===0?0:window.innerHeight/2+o}px`,i.style.height=`${window.innerHeight/2-o}px`)}):n.forEach((i,u)=>{i.style.top="0px",i.style.height=`${window.innerHeight}px`,i.style.opacity=`${d}`,t instanceof MouseEvent?(i.style.left=`${u===0?0:t.clientX+o}px`,i.style.width=`${u===0?t.clientX-o:window.innerWidth-t.clientX-o}px`):(i.style.left=`${u===0?0:window.innerWidth/2+o}px`,i.style.width=`${window.innerWidth/2-o}px`)})}else{n.forEach(s=>s.remove());return}}let S=null;const I=async(t,e)=>{S===null&&await new Promise(n=>{S=requestAnimationFrame(async()=>{try{await t(e)}finally{S=null,n()}})})},x={matches:["<all_urls>"],main(t){chrome.runtime.onMessage.addListener((e,n,s)=>{console.log(e.type),e.type===r.updateBlinds.CALL&&I(T,new Event("update"))}),t.addEventListener(document,"mousemove",e=>{I(T,e)})}},m=((z=(A=globalThis.browser)==null?void 0:A.runtime)==null?void 0:z.id)==null?globalThis.chrome:globalThis.browser;function g(t,...e){}const N={debug:(...t)=>g(console.debug,...t),log:(...t)=>g(console.log,...t),warn:(...t)=>g(console.warn,...t),error:(...t)=>g(console.error,...t)},b={BASE_URL:"/",BROWSER:"chrome",CHROME:!0,COMMAND:"build",DEV:!1,EDGE:!1,ENTRYPOINT:"content",FIREFOX:!1,MANIFEST_VERSION:3,MODE:"production",OPERA:!1,PROD:!0,SAFARI:!1,SSR:!1,VITE_CJS_IGNORE_WARNING:"true"},E=class E extends Event{constructor(e,n){super(E.EVENT_NAME,{}),this.newUrl=e,this.oldUrl=n}};a(E,"EVENT_NAME",w("wxt:locationchange"));let y=E;function w(t){var n;const e=typeof b>"u"?"build":"content";return`${(n=m==null?void 0:m.runtime)==null?void 0:n.id}:${e}:${t}`}function $(t){let e,n;return{run(){e==null&&(n=new URL(location.href),e=t.setInterval(()=>{let s=new URL(location.href);s.href!==n.href&&(window.dispatchEvent(new y(s,n)),n=s)},1e3))}}}const p=class p{constructor(e,n){a(this,"isTopFrame",window.self===window.top);a(this,"abortController");a(this,"locationWatcher",$(this));this.contentScriptName=e,this.options=n,this.abortController=new AbortController,this.isTopFrame?(this.listenForNewerScripts({ignoreFirstEvent:!0}),this.stopOldScripts()):this.listenForNewerScripts()}get signal(){return this.abortController.signal}abort(e){return this.abortController.abort(e)}get isInvalid(){return m.runtime.id==null&&this.notifyInvalidated(),this.signal.aborted}get isValid(){return!this.isInvalid}onInvalidated(e){return this.signal.addEventListener("abort",e),()=>this.signal.removeEventListener("abort",e)}block(){return new Promise(()=>{})}setInterval(e,n){const s=setInterval(()=>{this.isValid&&e()},n);return this.onInvalidated(()=>clearInterval(s)),s}setTimeout(e,n){const s=setTimeout(()=>{this.isValid&&e()},n);return this.onInvalidated(()=>clearTimeout(s)),s}requestAnimationFrame(e){const n=requestAnimationFrame((...s)=>{this.isValid&&e(...s)});return this.onInvalidated(()=>cancelAnimationFrame(n)),n}requestIdleCallback(e,n){const s=requestIdleCallback((...o)=>{this.signal.aborted||e(...o)},n);return this.onInvalidated(()=>cancelIdleCallback(s)),s}addEventListener(e,n,s,o){var d;n==="wxt:locationchange"&&this.isValid&&this.locationWatcher.run(),(d=e.addEventListener)==null||d.call(e,n.startsWith("wxt:")?w(n):n,s,{...o,signal:this.signal})}notifyInvalidated(){this.abort("Content script context invalidated"),N.debug(`Content script "${this.contentScriptName}" context invalidated`)}stopOldScripts(){window.postMessage({type:p.SCRIPT_STARTED_MESSAGE_TYPE,contentScriptName:this.contentScriptName},"*")}listenForNewerScripts(e){let n=!0;const s=o=>{var d,i;if(((d=o.data)==null?void 0:d.type)===p.SCRIPT_STARTED_MESSAGE_TYPE&&((i=o.data)==null?void 0:i.contentScriptName)===this.contentScriptName){const u=n;if(n=!1,u&&(e!=null&&e.ignoreFirstEvent))return;this.notifyInvalidated()}};addEventListener("message",s),this.onInvalidated(()=>removeEventListener("message",s))}};a(p,"SCRIPT_STARTED_MESSAGE_TYPE",w("wxt:content-script-started"));let v=p;function k(){}function f(t,...e){}const C={debug:(...t)=>f(console.debug,...t),log:(...t)=>f(console.log,...t),warn:(...t)=>f(console.warn,...t),error:(...t)=>f(console.error,...t)};return(async()=>{try{const{main:t,...e}=x,n=new v("content",e);return await t(n)}catch(t){throw C.error('The content script "content" crashed on startup!',t),t}})()}();
content;
